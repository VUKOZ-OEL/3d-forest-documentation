<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>3D Forest: Developer Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">var page_layout=1;</script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="side-nav" class="ui-resizable side-nav-resizable"><!-- do not remove this div, it is closed by doxygen! -->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">3D Forest
   </div>
   <div id="projectbrief">Software for analysis of Lidar data from forest environment.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
</div><!-- top -->
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('3d-forest-developer-guide.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Developer Guide</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>These documents describe how to build 3D Forest and develop new plugins using APIs in 3D Forest and other libraries.</p>
<h1><a class="anchor" id="git"></a>
Git</h1>
<h2><a class="anchor" id="git-get-code"></a>
Get the Source Code</h2>
<pre class="fragment">  git clone https://github.com/VUKOZ-OEL/3d-forest.git
  cd 3d-forest</pre><h2><a class="anchor" id="git-create-branch"></a>
Create New Branch</h2>
<ul>
<li>If you like to make some changes, then create your branch in GitHub:<ol type="1">
<li>Open web page '<a href="https://github.com/VUKOZ-OEL/3d-forest'">https://github.com/VUKOZ-OEL/3d-forest'</a>.</li>
<li>Click on 'main' button.</li>
<li>In 'Switch branches/tags' popup window:<ol type="a">
<li>Select field 'Filter branches/tags':</li>
<li>Type a name of your-branch. Example "vb" for "Vaclav Bubnik".</li>
<li>Hit enter.</li>
</ol>
</li>
</ol>
</li>
</ul>
<h2><a class="anchor" id="git-merging"></a>
Merging Your Changes</h2>
<ul>
<li>Switch to your branch if you like to make some changes: <pre class="fragment">  git checkout your-branch</pre></li>
<li>Merging 'main' into your branch is required before making contribution from your branch. Merging from 'main' may result to some unfortunate merge conflicts which are resolved manually. <pre class="fragment">  # Push your current changes in your branch if you have any (git status)
  git add --all
  git commit -m "Update"
  git push

  # Checking latest changes in 'main'
  git checkout main
  git fetch
  git pull

  # Merging 'main' into your branch
  git checkout your-branch
  git merge --no-ff -m "Merge branch 'main' into your-branch" main

  # Resolve conflicts and push
  git push

  # Merging your branch into 'main' (contribution, pull requests later)
  git checkout main
  git merge --no-ff -m "Merge branch 'your-branch' into main" your-branch
  git push

  # Return to your branch
  git checkout your-branch</pre></li>
</ul>
<h2><a class="anchor" id="git-commands"></a>
Commands</h2>
<ul>
<li>Common download sequence: <pre class="fragment">  git checkout &lt;branch&gt;
  git fetch
  git pull</pre></li>
<li>Common upload/backup of your local changes to GitHub: <pre class="fragment">  git branch
  git status
  git add &lt;path&gt;
  git add --all
  git commit -m "Add feature x"
  git push</pre></li>
</ul>
<h1><a class="anchor" id="build-linux-make"></a>
Build from Source Code in Linux with "Unix Makefiles"</h1>
<p>The code uses C++17, CMake, Qt5/Qt6 and OpenGL which will be installed in the following steps. Qt and OpenGL are required only for GUI desktop application.</p>
<div class="image">
<img src="3d-forest-linux.png" alt=""/>
<div class="caption">
3D Forest application on Lubuntu 20.04 (with LXQt desktop)</div></div>
<h2><a class="anchor" id="build-linux-make-apt"></a>
Install Packages</h2>
<ol type="1">
<li>Updating APT Packages <pre class="fragment">    $ sudo apt update
    $ sudo apt upgrade</pre></li>
<li>Installing Virtual Machine Tools [Optional] <pre class="fragment">    $ sudo apt install open-vm-tools-desktop</pre></li>
<li>Installing Additional Tools: gcc, g++, make, libc6-dev, etc. <pre class="fragment">    $ sudo apt install build-essential</pre></li>
<li>Installing Additional Tools: OpenGL and CMake from a terminal <pre class="fragment">    $ sudo apt install mesa-common-dev libglu1-mesa-dev
    $ sudo apt install cmake
    $ sudo apt install git</pre></li>
<li>Installing Required Libraries for Qt Installer [May not be necessary] <pre class="fragment">    $ sudo apt install libxcb-cursor0 libxcb-cursor-dev</pre></li>
</ol>
<h2><a class="anchor" id="build-linux-make-qt"></a>
Install Qt</h2>
<ul>
<li>Download Qt installer from <a href="https://www.qt.io/download">https://www.qt.io/download</a><ul>
<li>Click "Downloads for open source users" button in "Go open source"</li>
<li>Click "Download the Qt Online Installer" button in bottom section of the page "Looking for Qt binaries"</li>
<li>Recommended download was "Qt Online Installer for Linux (64-bit)"</li>
<li>"Download" button saved file "qt-unified-linux-x64-4.6.0-online.run"</li>
</ul>
</li>
<li>Run the installer<ul>
<li>Check "make file executable" in file properties of downloaded file</li>
<li>Open "qt-unified-linux-x64-4.6.0-online.run", shows "Qt Setup" window</li>
<li>Enter Qt Account Email and Password, "Next"</li>
<li>Check "I have read" and "I am an individual person", "Next", "Next"</li>
<li>"/home/user/Qt" is directory where Qt will be installed, default</li>
<li>Select "Custom installation", "Next"</li>
<li>The current installer allows to install versions 6.5.3 to 6.8.0<ul>
<li>Additionally checked: Qt - Qt 6.5.3 - Desktop gcc 64-bit</li>
<li>Additionally checked: Qt - Qt 6.5.3 - Sources</li>
</ul>
</li>
<li>To install older version like 5.15.0<ul>
<li>Check "Archive" checkbox and click "Filter" button</li>
<li>Click "Deselect All" button if you do not need Qt Design Studio etc.</li>
<li>Check Qt - Qt 5.15.0 - Desktop gcc 64-bit</li>
<li>Check Qt - Qt 5.15.0 - Sources</li>
</ul>
</li>
<li>Click "Next", license checkbox and "Next", click "Install"</li>
<li>Qt 5.15 installation used 3.65 GB of disk space and took about 10 minutes</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="build-linux-make-3dforest"></a>
Build 3D Forest</h2>
<ol type="1">
<li>Get 3D Forest source code <pre class="fragment">    $ cd /home/user/
    $ git clone https://github.com/VUKOZ-OEL/3d-forest.git</pre></li>
<li>Build 3D Forest <pre class="fragment">    $ cd /home/user/3d-forest
    $ mkdir build
    $ cd /home/user/3d-forest/build
    $ PATH=$PATH:/home/user/Qt/5.15.0/gcc_64/bin
    $ cmake -G "Unix Makefiles" .. -DCMAKE_INSTALL_PREFIX=.. -DCMAKE_INSTALL_RPATH="/home/user/3d-forest/bin;/home/user/Qt/5.15.0/gcc_64/lib" -DCMAKE_INSTALL_RPATH_USE_LINK_PATH=TRUE
    $ make
    $ make install</pre></li>
<li>Start 3D Forest application <pre class="fragment">    $ cd /home/user/3d-forest/bin
    $ ./3DForest</pre></li>
</ol>
<h1><a class="anchor" id="build-macos-make"></a>
Build from Source Code in Mac OS with "Unix Makefiles"</h1>
<p>The code uses C++17, CMake, Qt5/Qt6 and OpenGL which will be installed in the following steps. Qt and OpenGL are required only for GUI desktop application.</p>
<div class="image">
<img src="3d-forest-macos.png" alt=""/>
<div class="caption">
3D Forest application on macOS 10.13 1.4 GHz Processor, 4 GB Memory, GeForce 320M Graphics</div></div>
<h2><a class="anchor" id="build-macos-make-xcode"></a>
Install Xcode</h2>
<ul>
<li>Install Xcode from the App store</li>
<li>An alternative installation for old macs is described in <a href="http://while1.wz.cz/#how-to-install-old-versions-of-mac-os">http://while1.wz.cz/#how-to-install-old-versions-of-mac-os</a></li>
</ul>
<h2><a class="anchor" id="build-macos-make-cmake"></a>
Install CMake</h2>
<ul>
<li>Download official "cmake-3.24.0-macos-universal.dmg"</li>
<li>Copy "CMake.app" to "Applications"</li>
</ul>
<h2><a class="anchor" id="build-macos-make-qt"></a>
Install Qt</h2>
<ul>
<li>Download Qt installer from <a href="https://www.qt.io/download">https://www.qt.io/download</a><ul>
<li>Click "Downloads for open source users" button in "Go open source"</li>
<li>Click "Download the Qt Online Installer" button in bottom section of the page "Looking for Qt binaries"</li>
<li>Recommended download was "Qt Online Installer for mac OS"</li>
<li>Click "Download" button to save file "qt-unified-macOS-x64-4.4.1-online.dmg"</li>
</ul>
</li>
<li>Run the installer<ul>
<li>Copy "qt-unified-macOS-x64-4.4.1-online" from "qt-unified-macOS-x64-4.4.1-online.dmg"</li>
<li>Run "qt-unified-macOS-x64-4.4.1-online", it shows "Qt Setup" window</li>
<li>Enter your Qt Account Email and Password, "Next"</li>
<li>Check "I have read" and "I am an individual person", "Next", "Next"</li>
<li>"Preparing meta information download..." may take few minutes</li>
<li>The default installation directory is "/Users/user/Qt"</li>
<li>Select "Custom installation", "Next"</li>
<li>Qt 5 (computers from 2010)<ul>
<li>Unroll Qt tree item and check "Qt 5.15.2" or make your custom installation since doing this may install 31GB of useless stuff.</li>
<li>For example, check only the following for 10GB installation:<ul>
<li>macOS</li>
<li>Sources</li>
<li>Qt Debug Information Files</li>
<li>Qt Design Studio 3.5.0</li>
<li>CMake 3.23.2</li>
<li>Ninja 1.10.2</li>
</ul>
</li>
</ul>
</li>
<li>"Next", "Install", the installation takes between 10 to 30 minutes</li>
<li>Click "Finish"</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="build-macos-make-3d-forest"></a>
Build 3D Forest</h2>
<ul>
<li>Open "Terminal" tool from "Applications"</li>
<li>First clone the repository for example into "Documents/devel" as follows: <pre class="fragment">        cd Documents/devel/
        git clone https://github.com/VUKOZ-OEL/3d-forest.git
        cd 3d-forest</pre></li>
<li>Build source files to executable 3dforest application as follows: <pre class="fragment">        &gt; cd /Users/user/Documents/devel/3d-forest
        &gt; mkdir build
        &gt; cd build
        &gt; /Applications/CMake.app/Contents/bin/cmake -G "Unix Makefiles" .. -DCMAKE_INSTALL_PREFIX=.. -DCMAKE_PREFIX_PATH=/Users/user/Qt/5.15.2/clang_64 -DCMAKE_BUILD_TYPE=Debug -DBUILD_EXAMPLES=ON
        &gt; make
        &gt; make install</pre></li>
<li>Run file example: <pre class="fragment">        &gt; cd /Users/user/Documents/devel/3d-forest/bin
        &gt; DYLD_LIBRARY_PATH=$DYLD_LIBRARY_PATH:/Users/user/Documents/devel/3d-forest/bin ./3DForestExampleFile</pre></li>
<li>The following run.sh scrip can be written to run generated 3DForest.app: <pre class="fragment">        &gt; install_name_tool -change @rpath/lib3DForestGui.dylib /Users/user/Documents/devel/3d-forest/bin/lib3DForestGui.dylib 3DForest.app/Contents/MacOS/3DForest
        &gt; install_name_tool -change @rpath/lib3DForestEditor.dylib /Users/user/Documents/devel/3d-forest/bin/lib3DForestEditor.dylib 3DForest.app/Contents/MacOS/3DForest
        &gt; install_name_tool -change @rpath/lib3DForestCore.dylib /Users/user/Documents/devel/3d-forest/bin/lib3DForestCore.dylib 3DForest.app/Contents/MacOS/3DForest
        &gt; install_name_tool -change @rpath/QtOpenGL.framework/Versions/5/QtOpenGL /Users/user/Qt/5.15.2/clang_64/lib/QtOpenGL.framework/Versions/5/QtOpenGL 3DForest.app/Contents/MacOS/3DForest
        &gt; install_name_tool -change @rpath/QtWidgets.framework/Versions/5/QtWidgets /Users/user/Qt/5.15.2/clang_64/lib/QtWidgets.framework/Versions/5/QtWidgets 3DForest.app/Contents/MacOS/3DForest
        &gt; install_name_tool -change @rpath/QtGui.framework/Versions/5/QtGui /Users/user/Qt/5.15.2/clang_64/lib/QtGui.framework/Versions/5/QtGui 3DForest.app/Contents/MacOS/3DForest
        &gt; install_name_tool -change @rpath/QtCore.framework/Versions/5/QtCore /Users/user/Qt/5.15.2/clang_64/lib/QtCore.framework/Versions/5/QtCore 3DForest.app/Contents/MacOS/3DForest
        &gt; 3DForest.app/Contents/MacOS/3DForest
      @verbatim
    - Or to run generated executable 3DForest (by changing rpath to abs path):
      @verbatim
        &gt; cd /Users/user/Documents/devel/3d-forest/bin
        &gt; install_name_tool -change @rpath/lib3DForestGui.dylib /Users/user/Documents/devel/3d-forest/bin/lib3DForestGui.dylib 3DForest
        &gt; install_name_tool -change @rpath/lib3DForestEditor.dylib /Users/user/Documents/devel/3d-forest/bin/lib3DForestEditor.dylib 3DForest
        &gt; install_name_tool -change @rpath/lib3DForestCore.dylib /Users/user/Documents/devel/3d-forest/bin/lib3DForestCore.dylib 3DForest
        &gt; install_name_tool -change @rpath/QtOpenGL.framework/Versions/5/QtOpenGL /Users/user/Qt/5.15.2/clang_64/lib/QtOpenGL.framework/Versions/5/QtOpenGL 3DForest
        &gt; install_name_tool -change @rpath/QtWidgets.framework/Versions/5/QtWidgets /Users/user/Qt/5.15.2/clang_64/lib/QtWidgets.framework/Versions/5/QtWidgets 3DForest
        &gt; install_name_tool -change @rpath/QtGui.framework/Versions/5/QtGui /Users/user/Qt/5.15.2/clang_64/lib/QtGui.framework/Versions/5/QtGui 3DForest
        &gt; install_name_tool -change @rpath/QtCore.framework/Versions/5/QtCore /Users/user/Qt/5.15.2/clang_64/lib/QtCore.framework/Versions/5/QtCore 3DForest
        &gt; ./3DForest</pre></li>
</ul>
<h1><a class="anchor" id="build-windows-make"></a>
Build from Source Code in Windows with "MinGW Makefiles"</h1>
<p>The code uses C++17, CMake, Qt5/Qt6 and OpenGL which will be installed in the following steps. Qt and OpenGL are required only for GUI desktop application.</p>
<h2><a class="anchor" id="build-windows-make-git"></a>
Install git</h2>
<ul>
<li>Open "Git for windows" <a href="https://git-scm.com/downloads">https://git-scm.com/downloads</a></li>
<li>Download installer Git-2.36.1-64-bit.exe</li>
<li>Run the installer</li>
<li>Choose all the options as default recommended values with the following suggestions:<ul>
<li>You may enable "(NEW!) Add a Git Bash Profile to Windows Terminal".</li>
<li>You may prefer to choose default editor used by Git to "Notepad".</li>
<li>You may choose default branch name as "main".</li>
<li>Choose "Checkout as-is, commit as-is" eg. do not convert CRLF/LF (autocrlf = false in global config). This project uses LF line endings. Windows can handle LF just fine at least since version 10.</li>
</ul>
</li>
<li>Git installer creates global config in "C:/Users/user/AppData/Local/Programs/Git/etc/gitconfig" or "C:/Program Files/Git/etc/". <pre class="fragment">        [diff "astextplain"]
            textconv = astextplain
        [filter "lfs"]
            clean = git-lfs clean -- %f
            smudge = git-lfs smudge -- %f
            process = git-lfs filter-process
            required = true
        [http]
            sslBackend = openssl
            sslCAInfo = C:/Users/user/AppData/Local/Programs/Git/mingw64/ssl/certs/ca-bundle.crt
        [core]
            autocrlf = false
            fscache = true
            symlinks = false
            editor = notepad
        [pull]
            rebase = false
        [credential]
            helper = manager
        [credential "https://dev.azure.com"]
            useHttpPath = true
        [init]
            defaultBranch = main</pre></li>
<li>For development, setup your git user as follows:<ul>
<li>This creates configuration file in "C:\Users\user\.gitconfig": <pre class="fragment">          $ git config --global user.name "Vaclav Bubnik"
          $ git config --global user.email "vaclav@email.com"</pre></li>
<li>This creates configuration file in "C:\Users\user\.gitconfig": <pre class="fragment">            [user]
                email = vaclav@email.com
                name = Vaclav Bubnik</pre></li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="build-windows-make-mingw"></a>
Install msys2 and mingw-w64</h2>
<ul>
<li>Open <a href="https://www.msys2.org/">https://www.msys2.org/</a> and follow Installation instructions:<ul>
<li>Download the installer: msys2-x86_64-20220319.exe</li>
<li>Run the installer</li>
<li>Default installation will create "C:\msys64" installation folder</li>
<li>Click "Next"</li>
<li>Choose any "Start Menu shortcuts" and click "Next"</li>
<li>When complete, check "Run MSYS2 now" and click "Finish"</li>
<li>Run the following command to update package database <pre class="fragment">            $ pacman -Syu</pre></li>
<li>MSYS2 window will be closed</li>
<li>Run "MSYS2 MSYS" from Start menu and update the rest of the packages <pre class="fragment">            $ pacman -Syu</pre> or <pre class="fragment">            $ pacman -Su</pre></li>
</ul>
</li>
<li>Install additional packages<ul>
<li>Install required packages <pre class="fragment">            $ pacman -S mingw-w64-x86_64-clang
            $ pacman -S mingw-w64-x86_64-cmake
            $ pacman -S mingw-w64-x86_64-make</pre></li>
<li>Install optional packages to build documentation <pre class="fragment">            $ pacman -S mingw-w64-x86_64-doxygen
            $ pacman -S mingw-w64-x86_64-graphviz</pre></li>
<li>Install optional packages for python <pre class="fragment">            $ pacman -S mingw-w64-x86_64-python
            $ pacman -S mingw-w64-x86_64-python-pip</pre></li>
</ul>
</li>
<li>Close "MSYS2" window</li>
<li>Setup Windows PATH variable<ul>
<li>Run "systempropertiesadvanced" from the search box</li>
<li>Click "Environment Variables"</li>
<li>In "System variables" select Variable "Path" and click "Edit..."</li>
<li>Click "New" and add "C:\msys64\usr\bin", hit enter</li>
<li>Click "New" and add "C:\msys64\usr\local\bin", hit enter</li>
<li>Click "New" and add "C:\msys64\mingw64\bin", hit enter</li>
<li>"Move Up" these three new items to top</li>
<li>Click "Ok"</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="build-windows-make-qt"></a>
Install Qt</h2>
<ul>
<li>Download Qt installer from <a href="https://www.qt.io/download">https://www.qt.io/download</a><ul>
<li>Click "Downloads for open source users" button in "Go open source" or simply click "Download open source" in "Open source user?" section.</li>
<li>Click "Download the Qt Online Installer" button in bottom section of the page "Looking for Qt binaries"</li>
<li>Recommended download was "Qt Online Installer for Windows"</li>
<li>Click "Download" button to save file "qt-unified-windows-x86-4.3.0-1-online.exe" or "qt-unified-windows-x64-4.6.1-online.exe" if you are doing this in 2024.</li>
<li>You may need to download an offline installer in a case of network error.</li>
</ul>
</li>
<li>Run the installer<ul>
<li>Run "qt-unified-windows-x86-4.3.0-1-online.exe", it shows "Qt Setup" window</li>
<li>Enter your Qt Account Email and Password, "Next"</li>
<li>Check "I have read" and "I am an individual person", "Next", "Next"</li>
<li>"Preparing meta information download..." may take few minutes</li>
<li>It is suggested to keep default installation directory "C:\Qt"</li>
<li>Select "Custom installation", "Next"</li>
<li>Qt 6 2022<ul>
<li>Unroll Qt tree item and check "Qt 6.3.0" or make your custom installation since doing this may install 31GB of useless stuff.</li>
<li>For example, check only the following for 13GB installation:<ul>
<li>MinGW</li>
<li>Sources</li>
<li>Qt 5 Compatibility Module</li>
<li>Additional Libraries</li>
<li>Qt Debug Information Files</li>
</ul>
</li>
</ul>
</li>
<li>Qt 5 2000<ul>
<li>Additionally checked: Qt - Qt 5.15.2 - Desktop gcc 64-bit</li>
<li>Additionally checked: Qt - Qt 5.15.2 - Sources</li>
</ul>
</li>
<li>"Next", "Install", the installation takes between 10 to 30 minutes</li>
<li>Click "Finish"</li>
</ul>
</li>
<li>Run "systempropertiesadvanced" from the search box</li>
<li>Click "Environment Variables"</li>
<li>In "System variables" select Variable "Path" and click "Edit..."</li>
<li>Click "New" and add "C:\Qt\5.15.0\mingw81_64\bin" or "C:\Qt\6.3.0\mingw_64\bin" depending on your installed qt version</li>
</ul>
<h2><a class="anchor" id="build-windows-make-3dforest"></a>
Build 3D Forest</h2>
<ul>
<li>Open "cmd" terminal windows application</li>
<li>Use "cd" command to navigate to local git repository folder <pre class="fragment">        cd Documents\3d-forest</pre> or first clone the repository to "Documents" as follows: <pre class="fragment">        cd Documents
        git clone https://github.com/VUKOZ-OEL/3d-forest.git
        cd 3d-forest</pre></li>
<li>Build source files to executable 3dforest application as follows: <pre class="fragment">        &gt; mkdir build
        &gt; cd build
        &gt; cmake -G "MinGW Makefiles" .. -DCMAKE_INSTALL_PREFIX=..
        &gt; mingw32-make
        &gt; mingw32-make install</pre></li>
<li>Run 3dforest.exe from directory "Documents\3d-forest\bin"</li>
</ul>
<h2><a class="anchor" id="build-windows-make-vscode-devel"></a>
Development with Visual Studio Code</h2>
<ul>
<li>See section Edit Source Code with Visual Studio Code</li>
<li>See section Build and Debug in Visual Studio Code</li>
</ul>
<h1><a class="anchor" id="build-windows-visual-studio"></a>
Build from Source Code in Windows with Visual Studio</h1>
<p>The code uses C++17, CMake, Qt5/Qt6 and OpenGL which will be installed in the following steps. Qt and OpenGL are required only for GUI desktop application.</p>
<div class="image">
<img src="3d-forest-windows-visual-studio-debug.png" alt=""/>
<div class="caption">
3D Forest application in Visual Studio Debug</div></div>
<h2><a class="anchor" id="build-windows-visual-studio-git"></a>
Install git</h2>
<ul>
<li>Open "Git for windows" <a href="https://git-scm.com/downloads">https://git-scm.com/downloads</a></li>
<li>Download installer Git-2.36.1-64-bit.exe</li>
<li>Run the installer</li>
<li>Choose all the options as default recommended values with the following suggestions:<ul>
<li>You may prefer to choose default editor used by Git to "Notepad".</li>
<li>You may choose default branch name as "main".</li>
<li>Choose "Checkout as-is, commit as-is" eg. do not convert CRLF/LF (autocrlf = false in global config). This project uses LF line endings. Windows can handle LF just fine at least since version 10.</li>
</ul>
</li>
<li>Git installer creates global config in "C:/Users/user/AppData/Local/Programs/Git/etc/gitconfig". <pre class="fragment">        [diff "astextplain"]
            textconv = astextplain
        [filter "lfs"]
            clean = git-lfs clean -- %f
            smudge = git-lfs smudge -- %f
            process = git-lfs filter-process
            required = true
        [http]
            sslBackend = openssl
            sslCAInfo = C:/Users/user/AppData/Local/Programs/Git/mingw64/ssl/certs/ca-bundle.crt
        [core]
            autocrlf = false
            fscache = true
            symlinks = false
            editor = notepad
        [pull]
            rebase = false
        [credential]
            helper = manager-core
        [credential "https://dev.azure.com"]
            useHttpPath = true
        [init]
            defaultBranch = main</pre></li>
<li>For development, setup your git user as follows:<ul>
<li>This creates configuration file in "C:\Users\user\.gitconfig": <pre class="fragment">          $ git config --global user.name "Vaclav Bubnik"
          $ git config --global user.email "vaclav@email.com"</pre></li>
<li>This creates configuration file in "C:\Users\user\.gitconfig": <pre class="fragment">            [user]
                email = vaclav@email.com
                name = Vaclav Bubnik</pre></li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="build-windows-visual-studio-ide"></a>
Install Visual Studio</h2>
<ul>
<li>Open <a href="https://visualstudio.microsoft.com/downloads/">https://visualstudio.microsoft.com/downloads/</a></li>
<li>Click "Free download" in Visual Studio 2022 Community</li>
<li>Run VisualStudioSetup.exe</li>
<li>Select "Desktop development with C++", Total size is 8 GB or 10 GB depending on installer version.</li>
</ul>
<h2><a class="anchor" id="build-windows-visual-studio-qt"></a>
Install Qt</h2>
<ul>
<li>Download Qt installer from <a href="https://www.qt.io/download">https://www.qt.io/download</a><ul>
<li>Click "Downloads for open source users" button in "Go open source"</li>
<li>Click "Download the Qt Online Installer" button in bottom section of the page "Looking for Qt binaries"</li>
<li>Recommended download was "Qt Online Installer for Windows"</li>
<li>Click "Download" button to save file "qt-unified-windows-x86-4.3.0-1-online.exe"</li>
</ul>
</li>
<li>Run the installer<ul>
<li>Run "qt-unified-windows-x86-4.3.0-1-online.exe", it shows "Qt Setup" window</li>
<li>Enter your Qt Account Email and Password, "Next"</li>
<li>Check "I have read" and "I am an individual person", "Next", "Next"</li>
<li>"Preparing meta information download..." may take few minutes</li>
<li>It is suggested to keep default installation directory "C:\Qt"</li>
<li>Select "Custom installation", "Next"</li>
<li>Qt 6 2022<ul>
<li>Unroll Qt tree item and check "Qt 6.3.0" or make your custom installation since doing this may install 31GB of useless stuff.</li>
<li>For example, check only the following for 13GB installation:<ul>
<li>MSVC</li>
<li>Sources</li>
<li>Qt 5 Compatibility Module</li>
<li>Additional Libraries</li>
<li>Qt Debug Information Files</li>
</ul>
</li>
</ul>
</li>
<li>"Next", "Install", the installation takes between 10 to 30 minutes</li>
<li>Click "Finish"</li>
</ul>
</li>
<li>Run "systempropertiesadvanced" from the search box</li>
<li>Click "Environment Variables"</li>
<li>In "System variables" select Variable "Path" and click "Edit..."</li>
<li>Click "New" and add "C:\Qt\6.3.0\msvc2019_64\bin"</li>
</ul>
<h2><a class="anchor" id="build-windows-visual-studio-3dforest"></a>
Build 3D Forest</h2>
<ul>
<li>Open directory "3d-forest" in Visual Studio. This will automatically create Visual Studio solution from CMake files.</li>
<li>Change "Select Startup Item" to "3dforest.exe (install) (bin\3dforest.exe)" from the tool bar.</li>
<li>Click on "3dforest.exe (install) (bin\3dforest.exe)" to build and start 3d Forest.</li>
</ul>
<h1><a class="anchor" id="add-new-functionality"></a>
Add New Functionality</h1>
<h2><a class="anchor" id="add-new-functionality-plugins"></a>
Plugins</h2>
<p>There are several ways to add new functionality. The most easy way is to add new external plugin. External plugins are self contained. It is not necessary to touch any file outside of your plugin directory with exception of one cmake file.</p><ol type="1">
<li>To start, one can copy and modify existing external plugin such as "src/plugins/classification" to new directory "src/plugins/myplugin".</li>
<li>Add path to "src/plugins/CMakeLists.txt" to build the new plugin: <pre class="fragment">        add_subdirectory(myplugin)</pre></li>
<li>External plugins will be visible from application main window.</li>
</ol>
<h2><a class="anchor" id="add-new-functionality-tools"></a>
Tools</h2>
<p>It is possible to add new command line tool to "src/apps/tools/mytool".</p><ol type="1">
<li>Example command line tool "src/apps/tools/sandbox".</li>
<li>Example command line tool with Qt "src/apps/tools/icon".</li>
<li>Tools are not available from application main window.</li>
</ol>
<h2><a class="anchor" id="add-new-functionality-internal-plugins"></a>
Internal Plugins</h2>
<p>The third way is to add new internal plugin.</p><ol type="1">
<li>To start, one can copy and modify existing internal plugin such as "src/plugins/projectfile" to new directory "src/plugins/myplugin".</li>
<li>Modify "src/gui/CMakeLists.txt" to build the new plugin into core: <pre class="fragment">        file(GLOB_RECURSE SOURCES_MYACTION "../plugins/myplugin/*.cpp")
        add_library
          ${SOURCES_MYACTION}
          ../plugins/myplugin/resources/resources.qrc
        target_include_directories
          ../plugins/myplugin</pre></li>
<li>Add field "myPlugin_" to "src/gui/MainWindow.hpp". <pre class="fragment">        class MyPlugin;
        MyPlugin *myPlugin_;</pre></li>
<li>Create instance in "src/gui/MainWindow.cpp" constructor. <pre class="fragment">        myPlugin_ = new MyPlugin();
        myPlugin_-&gt;initialize(this);</pre></li>
<li>Internal plugins will be visible from application main window.</li>
</ol>
<h2><a class="anchor" id="add-new-functionality-extend-core-functionality"></a>
Extend Core Functionality</h2>
<p>The last and most difficult way is to modify core functionality in the following directories. This functionality is available in all plugins.</p><ul>
<li>"src/core" build to "lib3dforestcore.dll"</li>
<li>"src/editor" build to "lib3dforesteditor.dll"</li>
<li>"src/gui" build to "lib3dforestgui.dll"</li>
</ul>
<h2><a class="anchor" id="add-new-functionality-general"></a>
General</h2>
<ol type="1">
<li>The main() 3D Forest application is in "src/apps/3dforest/3dforest.cpp".</li>
<li>For development with Visual Studio Code, update ".vscode/settings.json" to contain new directories. For example, add "${workspaceRoot}/src/plugins/myaction" to "C_Cpp.default.includePath" include paths.</li>
<li>Need some icon? Try to look into <a href="https://github.com/VUKOZ-OEL/3d-forest-icons">https://github.com/VUKOZ-OEL/3d-forest-icons</a></li>
</ol>
<h1><a class="anchor" id="code-format"></a>
Code Format Suggestions</h1>
<h2><a class="anchor" id="code-format-automatic"></a>
Automatic Code Formatting</h2>
<p>The following command performs automatic code formatting. It is good to run this command before 'git add &lt;file&gt;' and git commit to GitHub: </p><pre class="fragment">mingw32-make format
</pre><h2><a class="anchor" id="code-format-names"></a>
Names</h2>
<p>The code is using C++ std on Backend and Qt on Frontend.</p>
<p>Function names follow mixed Qt style and std: </p><pre class="fragment">get:
    bool   hasFocus() const;
    bool   isHidden() const;
    int    height() const;
    size_t size() const; // Can be better than Qt like 'count'. std uses 'size'.

get/set:
    bool isSizeGripEnabled() const;     // get
    void setSizeGripEnabled(bool);      // set

    int  result() const;                // get
    void setResult(int i);              // set

    const T &amp;at(int i) const;           // get (inconsistent, easy to read)
    void append(const QList&lt;T&gt; &amp;value); // set (inconsistent, easy to read)

signals:
    void accepted();
    void finished(int result);
    void rejected();
    void toolsRequested(const QString &amp;source);
    void findTextFinished(const QString &amp;text);
    void loadProgress(int progress);
</pre><h2><a class="anchor" id="code-format-file-names"></a>
File Names</h2>
<pre class="fragment">directory "3rd Party" is "3rdparty" lowercase, no separators

source    "MainWindow.hpp"          C++ header, CamelCase for classes
          "MainWindow.cpp"          C++ source, CamelCase for classes
          "examplecolorpalette.cpp" lowercase for executables
          "las.cpp"                 lowercase for executables

files     anything
          "README.md"
          "CMakeLists.txt"
          "layout_grid_24px.png"
          ".clang-format"
          ".gitignore"
</pre><h1><a class="anchor" id="logging"></a>
Logging</h1>
<p>Example log for file DescriptorPca.cpp </p><pre class="fragment">#define LOG_MODULE_NAME "DescriptorPca"
#define LOG_MODULE_DEBUG_ENABLED 1 /* Define to enable all debug log messages from this file. */
#include &lt;Log.hpp&gt;
LOG_DEBUG(&lt;&lt; "Found &lt;" &lt;&lt; nPoints &lt;&lt; "&gt; points.");
</pre><h1><a class="anchor" id="doxygen"></a>
Doxygen</h1>
<p>Example command to generate documentation: </p><pre class="fragment">mingw32-make doc
</pre><p>Your favorite syntax of documentation comments.</p>
<p>Suggestions: </p><pre class="fragment">/** First paragraph is automatically brief

    &lt;detail description&gt;

    @todo Documentation is not complete.
*/

int value; /**&lt; field description, after */

/** Link to function foo() */
/** Link to parameter @e value */
void foo(value);

[in], [out], [in,out] for parameters:
/** @param [in] milliseconds sleep until milliseconds have elapsed. */
void Time::msleep(long milliseconds);

Group 'Point Data' creates hierarchy in generated output:
    /** @name Point Data */
    /**@{*/

    /** Point coordinates. */
    std::vector&lt;double&gt; xyz;

    /** Pulse return magnitude. */
    std::vector&lt;float&gt; intensity;

    /**@}*/

Examples:
/** JSON.

@example
    Json obj;
    obj["name"] = "John";
    std::cout &lt;&lt; obj &lt;&lt; "\n"; // Output: {"name":"John"}
@endexample
*/

/**
    @section
    @subsection
*/

/** @file Window.hpp */
/** @class Window.cpp::Window

    Documenting another file.
*/
</pre><h1><a class="anchor" id="generate-help-manuals"></a>
Generate Help Manuals</h1>
<p>We would like to be able to give users access to documentation from within the user interface of our application. This section demonstrates how to edit, generate and distribute such documentation with 3D Forest.</p>
<p>These are the locations where it is possible to write the documentation:</p><ul>
<li>'User Guide' in directory 'doc\userguide'.</li>
<li>'Developer Guide' in directory 'doc\developerguide'.</li>
<li>Doxygen comments in the source code.</li>
</ul>
<p>The following steps will generate the documentation and prepare it for distribution:</p><ol type="1">
<li>The following commands are executed from directory 'build'.</li>
<li>Doxygen command line tool is used to create manual pages as follows: <pre class="fragment">    mingw32-make doxygen</pre> Produced output: html\index.qhp, html\index.qch</li>
<li>We run 'qhelpgenerator' command to generate qt help with index: <pre class="fragment">    qhelpgenerator ..\doc\index.qhcp -o html\index.qhc</pre> Produced output: html\index.qhc, html\index.qch</li>
<li>We copy '3dforest.qch' and '3dforest.qhc' to 'documentation' directory. These are help files to be shipped with the application: <pre class="fragment">    mkdir ..\bin\documentation
    copy html\index.qhc ..\bin\documentation\
    copy html\index.qch ..\bin\documentation\</pre></li>
</ol>
<p>To show the documentation in the application:</p><ol type="1">
<li>First, we start 3dforest.exe. (Application binary name depends on platform.)</li>
<li>We access help via 'Help-&gt;Manual'.</li>
<li>The previous step displays Help dialog with table of contents on the left side and relevant html page on the right side.</li>
</ol>
<h1><a class="anchor" id="adding-3rd-party-library"></a>
Adding Third Party Libraries</h1>
<p>Third party libraries used by 3D Forest are copied to '3rdparty' directory and therefore distributed together with 3D Forest. 3rd party code is build as a part of 3D Forest build process. This removes inconvenient step which would require to search, download and install dependencies.</p>
<p>GPLv3 compatibility matrix: <a href="https://www.gnu.org/licenses/gpl-faq.en.html#AllCompatibility">https://www.gnu.org/licenses/gpl-faq.en.html#AllCompatibility</a></p>
<p>GPL-Compatible Free Software Licenses: <a href="https://www.gnu.org/licenses/license-list.html#GPLCompatibleLicenses">https://www.gnu.org/licenses/license-list.html#GPLCompatibleLicenses</a></p>
<p>GPL-Incompatible Free Software Licenses: <a href="https://www.gnu.org/licenses/license-list.html#GPLIncompatibleLicenses">https://www.gnu.org/licenses/license-list.html#GPLIncompatibleLicenses</a></p>
<h1><a class="anchor" id="cheatsheet"></a>
Cheat Sheet</h1>
<h2><a class="anchor" id="cheatsheet-cmake"></a>
CMake Build Script</h2>
<p>Example Windows build script executed from directory build: </p><pre class="fragment">cmake -G "MinGW Makefiles" .. -DCMAKE_INSTALL_PREFIX=.. -DCMAKE_BUILD_TYPE=Debug -DBUILD_EXAMPLES=ON
mingw32-make format
mingw32-make
mingw32-make install
mingw32-make doxygen
qhelpgenerator ..\doc\index.qhcp -o html\index.qhc
mkdir ..\bin\documentation
copy html\index.qhc ..\bin\documentation\
copy html\index.qch ..\bin\documentation\
</pre><h2><a class="anchor" id="cheatsheet-qtdesigner"></a>
Qt Designer</h2>
<p>Conversion of '.ui' files to '.hpp' files by using 'uic' command line tool: </p><pre class="fragment">which uic
uic -o ui_window.h window.ui
</pre><h2><a class="anchor" id="cheatsheet-rename-files"></a>
Rename Files</h2>
<p>Rename filenames: </p><pre class="fragment">powershell -C "gci | % {rni $_.Name ($_.Name -replace '24px', '24')}"
</pre><h2><a class="anchor" id="cheatsheet-vscode-edit"></a>
Edit Source Code with Visual Studio Code</h2>
<ol type="1">
<li>Download and install Visual Studio Code<ul>
<li>For Windows or Linux from <a href="https://code.visualstudio.com/">https://code.visualstudio.com/</a></li>
<li>Linux packages can be installed with: sudo apt install ./&lt;downloaded&gt;.deb</li>
<li>Tested with version 1.56.2.</li>
</ul>
</li>
<li>In file explorer, right-click on folder "3d-forest" and select "Open with Code". This will open 3D Forest workspace.</li>
<li>Install extension "C/C++ IntelliSense, debugging, and code browsing". Extension identifier is "ms-vscode.cpptools". Tested with v1.4.0.</li>
<li>Install extension "CMake Tools". Extension identifier is "ms-vscode.cmake-tools". Tested with v1.7.3.</li>
<li>Optionally install extension "CMake langage support for Visual Studio Code". Extension identifier is "twxs.cmake".</li>
<li>Optionally install extension "Code Spell Checker". Extension identifier is "streetsidesoftware.code-spell-checker".</li>
<li>On Windows, add the following lines to "3d-forest/.vscode/settings.json" (compiler path and IntelliSense settings): <pre class="fragment">    {
      "files.eol": "\n",
      "C_Cpp.default.includePath":[
        "C:/Qt/6.3.0/mingw_64/include/**",
        "${workspaceRoot}/3rdparty/delaunator",
        "${workspaceRoot}/3rdparty/eigen",
        "${workspaceRoot}/3rdparty/libigl/include",
        "${workspaceRoot}/3rdparty/stb",
        "${workspaceRoot}/3rdparty/unibnoctree",
        "${workspaceRoot}/3rdparty/warnings",
        "${workspaceRoot}/3rdparty/widgets/ctk",
        "${workspaceRoot}/3rdparty/widgets/flowlayout",
        "${workspaceRoot}/src/apps/3dforest",
        "${workspaceRoot}/src/apps/tests",
        "${workspaceRoot}/src/apps/tools/sandbox",
        "${workspaceRoot}/src/core",
        "${workspaceRoot}/src/editor",
        "${workspaceRoot}/src/gui",
        "${workspaceRoot}/src/plugins/ComputeClassification",
        "${workspaceRoot}/src/plugins/ComputeDescriptor",
        "${workspaceRoot}/src/plugins/ComputeElevation",
        "${workspaceRoot}/src/plugins/ComputeHeightMap",
        "${workspaceRoot}/src/plugins/ComputeSegmentationNN",
        "${workspaceRoot}/src/plugins/ComputeTreeAttributes",
        "${workspaceRoot}/src/plugins/Edit",
        "${workspaceRoot}/src/plugins/ExportFile",
        "${workspaceRoot}/src/plugins/FilterArea",
        "${workspaceRoot}/src/plugins/FilterClassification",
        "${workspaceRoot}/src/plugins/FilterDescriptor",
        "${workspaceRoot}/src/plugins/FilterElevation",
        "${workspaceRoot}/src/plugins/FilterFiles",
        "${workspaceRoot}/src/plugins/FilterIntensity",
        "${workspaceRoot}/src/plugins/FilterTrees",
        "${workspaceRoot}/src/plugins/Help",
        "${workspaceRoot}/src/plugins/ImportFile",
        "${workspaceRoot}/src/plugins/MessageLog",
        "${workspaceRoot}/src/plugins/ProjectFile",
        "${workspaceRoot}/src/plugins/SettingsUnits",
        "${workspaceRoot}/src/plugins/SettingsView",
        "${workspaceRoot}/src/plugins/TreeTable",
        "${workspaceRoot}/src/plugins/Viewer"
      ]
    }</pre></li>
<li>Close the window and reopen to the same folder to apply new settings.</li>
</ol>
<h2><a class="anchor" id="cheatsheet-vscode-debug"></a>
Build and Debug in Visual Studio Code</h2>
<ol type="1">
<li>Install GDB for msys2:<ul>
<li>Open windows Command prompt "cmd".</li>
<li>Search for gdb to find a specific package in the repository: &gt; pacman -Ss gdb</li>
<li>For example use the following command to install gdb package: &gt; pacman -S mingw-w64-x86_64-gdb</li>
</ul>
</li>
<li>Open Visual Studio Code</li>
<li>On Windows, Add the following lines to settings.json: <pre class="fragment">    {
        "cmake.configureOnOpen": false,
        "cmake.mingwSearchDirs": [
            "C:\\msys64\\mingw-w64\\bin"
        ],
        "cmake.generator": "MinGW Makefiles",
    }</pre></li>
<li>Select a kit:<ul>
<li>Open the Command Palette.</li>
<li>Run "CMake: Select a Kit".</li>
<li>Click "[Scan for kits]".</li>
<li>Select the compiler. For example "GCC 10.1.0 Using compilers:
      C= C:\msys64\mingw-w64\bin\gcc.exe, CXX= C:\msys64\mingw-w64\bin\g++.exe".</li>
</ul>
</li>
<li>Select a variant:<ul>
<li>Open the Command Palette.</li>
<li>Run "CMake: Select Variant".</li>
<li>Select "Debug" to include debug information with your build.</li>
</ul>
</li>
<li>On Windows, create 'launch.json' (debugger settings, perform CMake build) in '.vscode' directory: <pre class="fragment">    {
        "version": "0.2.0",
        "configurations": [
            {
                "name": "(gdb) Launch",
                "type": "cppdbg",
                "request": "launch",
                "program": "${workspaceFolder}/3dforest.exe",
                "args": [],
                "stopAtEntry": false,
                "cwd": "${workspaceFolder}",
                "environment": [],
                "externalConsole": false,
                "MIMode": "gdb",
                "setupCommands": [
                    {
                        "description": "Enable pretty-printing for gdb",
                        "text": "-enable-pretty-printing",
                        "ignoreFailures": true
                    }
                ]
            }
        ]
    }</pre></li>
<li>You may also create file 'tasks.json' (build instructions) in '.vscode' directory: <pre class="fragment">    {
        "version": "2.0.0",
        "command": "sh",
        "args": ["-c"],
        "presentation":
        {
            "echo": true,
            "reveal": "always",
            "focus": true,
            "panel": "new"
        },
        "tasks": [
            {
                "label": "cmake",
                "type": "shell",
                "options":
                {
                    "cwd": "${workspaceRoot}/build"
                },
                "args": ["cmake -G 'MinGW Makefiles' .. -DCMAKE_INSTALL_PREFIX=.."]
            },
            {
                "label": "make",
                "type": "shell",
                "args": ["mingw32-make"],
                "options": {"cwd": "${workspaceRoot}/build"},
                "dependsOn": ["cmake"],
                "group": {"kind": "build","isDefault": true}
            }
        ]
    }</pre></li>
<li>To build click "Build the selected target".</li>
<li>Copy shared libraries to the same folder as "3dforest.exe": build\src\apps\3dforest\<ul>
<li>lib3dforestcore.dll</li>
<li>lib3dforesteditor.dll</li>
<li>lib3dforestgui.dll</li>
</ul>
</li>
<li>To debug click "Launch the debugger for the selected target: [3dforest]". </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.4-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      Copyright 2020-present VUKOZ Documentation contributions included herein are the copyrights of their respective owners.
      The documentation provided herein is licensed under the terms of the
      <a href="https://www.gnu.org/licenses/fdl.html">GNU Free Documentation License version 1.3</a> as published by the Free Software Foundation.
    </li>
  </ul>
</div>
</body>
</html>
